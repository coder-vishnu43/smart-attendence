<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>faculty dashboard</title>
</head>

<body>
    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Faculty Dashboard • QR‑Attend+</title>
        <style>
            :root {
                --bg: #0b1220;
                --card: rgba(255, 255, 255, 0.08);
                --border: rgba(255, 255, 255, 0.12);
                --text: #e6eefc;
                --muted: #9fb3d9;
                --primary: #5b8cff;
                --accent: #22d3ee;
                --good: #86efac;
                --bad: #ff6b6b;
                --radius: 14px;
                --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
            }

            body {
                margin: 0;
                font-family: system-ui, sans-serif;
                background: var(--bg);
                color: var(--text);
            }

            header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 16px 20px;
                border-bottom: 1px solid var(--border);
            }

            .brand {
                font-weight: 800;
            }

            .user {
                font-size: 14px;
                color: var(--muted);
            }

            main {
                max-width: 1000px;
                margin: 20px auto;
                padding: 0 16px;
                display: grid;
                gap: 16px;
                grid-template-columns: 1fr;
            }

            .card {
                background: var(--card);
                border: 1px solid var(--border);
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                padding: 18px;
            }

            h2 {
                margin: 0 0 10px;
                font-size: 18px;
            }

            p.muted {
                color: var(--muted);
                font-size: 14px;
            }

            input,
            button {
                padding: 10px;
                border-radius: 10px;
                border: 1px solid var(--border);
                background: rgba(255, 255, 255, 0.06);
                color: var(--text);
            }

            button {
                background: linear-gradient(90deg, var(--primary), var(--accent));
                border: none;
                color: #071220;
                font-weight: 700;
                cursor: pointer;
            }

            button.ghost {
                background: transparent;
                color: var(--text);
                border: 1px solid var(--border);
            }

            .session {
                padding: 12px;
                border: 1px solid var(--border);
                border-radius: 10px;
                margin-bottom: 10px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .attendees-list {
                font-size: 14px;
                color: var(--muted);
                margin-top: 5px;
            }
        </style>
    </head>

    <body>
        <header>
            <div class="brand">QR‑Attend+ • Faculty</div>
            <div class="row">
                <div class="user" id="userInfo">—</div>
                <button class="ghost" id="signOutBtn">Sign out</button>
            </div>
        </header>

        <main>
            <section class="card">
                <h2>Create New Session</h2>
                <input id="titleInput" placeholder="Session title" />
                <input id="codeInput" placeholder="Session code (e.g., ABC123)" />
                <input id="timeInput" placeholder="Time (e.g., 10:00 AM)" />
                <button id="createSessionBtn">Create Session</button>
                <div id="createMsg" class="msg"></div>
            </section>

            <section class="card">
                <h2>Active Sessions</h2>
                <div id="sessionsList"></div>
            </section>
        </main>

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
            import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

            const firebaseConfig = {
                apiKey: "AIzaSyBMhQhiB0wFseVuhnM7mZLrs_mUPCRlQm4",
                authDomain: "faculty-login-25b76.firebaseapp.com",
                projectId: "faculty-login-25b76",
                storageBucket: "faculty-login-25b76.firebasestorage.app",
                messagingSenderId: "692824679077",
                appId: "1:692824679077:web:9acb1d5ad29c9352e5234c",
                measurementId: "G-C99EPRR4K2"
            }

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    document.getElementById("userInfo").textContent = user.email;
                    loadSessions();
                } else {
                    window.location.href = "faculty-dashboard.html";
                }
            });

            document.getElementById("signOutBtn").addEventListener("click", () => {
                signOut(auth).then(() => window.location.href = "faculty-dashboard.html");
            });

            async function loadSessions() {
                const res = await fetch("http://127.0.0.1:5000/sessions");
                const data = await res.json();
                const container = document.getElementById("sessionsList");
                container.innerHTML = "";
                data.forEach(session => {
                    const div = document.createElement("div");
                    div.className = "session";
                    div.innerHTML = `
          <div>
            <strong>${session.title}</strong> (${session.id})<br>
            <span class="attendees-list">Attendees: ${session.attendees ? session.attendees.length : 0}</span>
          </div>
          <div>
            <button onclick="closeSession('${session.id}')">Close</button>
            <button onclick="viewAttendees('${session.id}')">View</button>
          </div>
        `;
                    container.appendChild(div);
                });
            }

            document.getElementById("createSessionBtn").addEventListener("click", async () => {
                const title = document.getElementById("titleInput").value.trim();
                const code = document.getElementById("codeInput").value.trim();
                const time = document.getElementById("timeInput").value.trim();
                const msg = document.getElementById("createMsg");

                if (!title || !code || !time) {
                    msg.textContent = "Please fill all fields.";
                    return;
                }

                const user = auth.currentUser;
                const idToken = await user.getIdToken();

                const res = await fetch("http://127.0.0.1:5000/create-session", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": idToken
                    },
                    body: JSON.stringify({ title, code, time })
                });

                const data = await res.json();
                msg.textContent = res.ok ? "✅ Session created!" : "❌ " + data.error;
                if (res.ok) loadSessions();
            });

            window.closeSession = async (code) => {
                const user = auth.currentUser;
                const idToken = await user.getIdToken();
                await fetch(`http://127.0.0.1:5000/close-session/${code}`, {
                    method: "POST",
                    headers: { "Authorization": idToken }
                });
                loadSessions();
            };

            window.viewAttendees = async (code) => {
                const res = await fetch(`http://127.0.0.1:5000/attendees/${code}`);
                const data = await res.json();
                alert(`Attendees for ${code}:\n` + data.join("\n"));
            };
        </script>
    </body>

    </html>
</body>

</html>